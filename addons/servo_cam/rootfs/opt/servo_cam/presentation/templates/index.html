<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Camera System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #4fc3f7;
        }

        .video-section {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }

        .video-container {
            position: relative;
            width: 100%;
            border: 3px solid #333;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }

        #video-feed {
            width: 100%;
            display: block;
        }

        .monitoring-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            backdrop-filter: blur(5px);
            z-index: 10;
        }

        .monitoring-badge.active {
            background: rgba(76, 175, 80, 0.9);
            border: 2px solid #4caf50;
        }

        .monitoring-badge.inactive {
            background: rgba(158, 158, 158, 0.9);
            border: 2px solid #757575;
        }

        .status-panel {
            background: rgba(30, 30, 46, 0.95);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            background: rgba(50, 50, 70, 0.6);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #4fc3f7;
        }

        .status-label {
            font-size: 0.85em;
            color: #aaa;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #fff;
        }

        .control-panel {
            background: rgba(30, 30, 46, 0.95);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .monitoring-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #da190b 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #607d8b 0%, #546e7a 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(96, 125, 139, 0.4);
        }

        .servo-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .servo-axis {
            background: rgba(50, 50, 70, 0.6);
            padding: 20px;
            border-radius: 10px;
        }

        .servo-axis h4 {
            color: #4fc3f7;
            margin-bottom: 15px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #444;
            outline: none;
            margin: 15px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4fc3f7;
            cursor: pointer;
        }

        .angle-display {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #4fc3f7;
            margin-top: 10px;
        }

        .direction-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .dir-btn {
            padding: 15px;
            background: rgba(79, 195, 247, 0.2);
            border: 2px solid #4fc3f7;
            border-radius: 8px;
            color: #4fc3f7;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .dir-btn:hover {
            background: rgba(79, 195, 247, 0.4);
            transform: scale(1.05);
        }

        .dir-btn:active {
            transform: scale(0.95);
        }

        .dpad-container {
            background: rgba(50, 50, 70, 0.6);
            padding: 25px;
            border-radius: 12px;
            width: 280px;
            border: 2px solid #4fc3f7;
        }

        .dpad-side-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .dpad-grid {
            display: grid;
            grid-template-areas:
                ". up ."
                "left center right"
                ". down .";
            gap: 8px;
            margin: 15px 0;
        }

        .dpad-btn {
            padding: 20px;
            background: rgba(79, 195, 247, 0.3);
            border: 2px solid #4fc3f7;
            border-radius: 10px;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .dpad-btn:hover {
            background: rgba(79, 195, 247, 0.5);
            transform: scale(1.05);
        }

        .dpad-btn:active {
            background: rgba(79, 195, 247, 0.7);
            transform: scale(0.95);
        }

        .dpad-up { grid-area: up; }
        .dpad-down { grid-area: down; }
        .dpad-left { grid-area: left; }
        .dpad-right { grid-area: right; }
        .dpad-center {
            grid-area: center;
            background: rgba(244, 67, 54, 0.3);
            border-color: #f44336;
        }

        .dpad-center:hover {
            background: rgba(244, 67, 54, 0.5);
        }

        .config-section {
            margin-top: 25px;
        }

        .config-group {
            background: rgba(50, 50, 70, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .config-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .config-row:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 500;
            color: #aaa;
        }

        input[type="number"] {
            background: rgba(30, 30, 46, 0.8);
            border: 1px solid #4fc3f7;
            color: #fff;
            padding: 8px 12px;
            border-radius: 5px;
            width: 100px;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .save-btn {
            width: 100%;
            margin-top: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .alert-info {
            background: rgba(33, 150, 243, 0.2);
            border: 2px solid #2196f3;
            color: #64b5f6;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #777;
            font-size: 0.9em;
        }

        footer a {
            color: #4fc3f7;
            text-decoration: none;
        }

        input[type="text"],
        input[type="url"] {
            background: rgba(30, 30, 46, 0.8);
            border: 1px solid #4fc3f7;
            color: #fff;
            padding: 10px 12px;
            border-radius: 5px;
            width: 100%;
            font-size: 14px;
        }

        input[type="text"]:focus,
        input[type="url"]:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 8px rgba(79, 195, 247, 0.4);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: 0.3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4caf50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        @media (max-width: 1024px) {
            .video-section {
                grid-template-columns: 1fr;
            }

            .dpad-side-panel {
                flex-direction: row;
                justify-content: center;
            }

            .dpad-container {
                width: auto;
                min-width: 250px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            header p {
                font-size: 0.85em;
            }

            .servo-controls {
                grid-template-columns: 1fr;
            }

            .monitoring-controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dpad-side-panel {
                flex-direction: column;
            }

            .dpad-container {
                width: 100%;
            }

            .quick-actions {
                width: 100%;
            }
        }

        @media (min-width: 769px) {
            .servo-controls {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        .quick-actions {
            background: rgba(50, 50, 70, 0.6);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-actions .btn {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîí Security Camera System</h1>
            <p>Motion Tracking ‚Ä¢ Servo Control ‚Ä¢ Webhook Alerts</p>
        </header>

        <!-- Video Feed and D-Pad Section -->
        <div class="video-section">
            <div class="video-container">
                <div id="monitoring-badge" class="monitoring-badge inactive">MONITORING OFF</div>
                <img id="video-feed" src="{{ url_for('video_feed') }}" alt="Camera Feed">
            </div>

            <!-- D-Pad Side Panel -->
            <div class="dpad-side-panel">
                <div class="dpad-container">
                    <h4 style="text-align: center; color: #4fc3f7; margin-bottom: 15px;">üéÆ D-Pad Control</h4>
                    <div class="dpad-grid">
                        <button class="dpad-btn dpad-up" onclick="moveDpad('up')">‚ñ≤</button>
                        <button class="dpad-btn dpad-left" onclick="moveDpad('left')">‚óÄ</button>
                        <button class="dpad-btn dpad-center" onclick="moveDpad('center')">‚óè</button>
                        <button class="dpad-btn dpad-right" onclick="moveDpad('right')">‚ñ∂</button>
                        <button class="dpad-btn dpad-down" onclick="moveDpad('down')">‚ñº</button>
                    </div>
                    <div style="text-align: center; color: #aaa; font-size: 0.9em; margin-top: 15px;">
                        Step: <span id="step-display" style="color: #4fc3f7; font-weight: bold;">10</span>¬∞
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="btn btn-primary" id="btn-monitoring-toggle-side" onclick="toggleMonitoring()">
                        Start Monitoring
                    </button>
                    <button class="btn btn-secondary" onclick="centerServos()">
                        ‚äô Center
                    </button>
                </div>
            </div>
        </div>

        <!-- Status Panel -->
        <div class="status-panel">
            <h3>üìä System Status</h3>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">Camera</div>
                    <div class="status-value" id="status-camera">---</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Servo Controller</div>
                    <div class="status-value" id="status-servo">---</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Pan Angle</div>
                    <div class="status-value" id="status-pan">---¬∞</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Tilt Angle</div>
                    <div class="status-value" id="status-tilt">---¬∞</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Webhook Queue</div>
                    <div class="status-value" id="status-webhook">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Motion Events</div>
                    <div class="status-value" id="status-motion">0</div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <!-- Monitoring Controls -->
            <div class="control-section">
                <h3>üéØ Security Monitoring</h3>
                <div class="monitoring-controls">
                    <button id="btn-monitoring-toggle" class="btn btn-primary" onclick="toggleMonitoring()">
                        Start Monitoring
                    </button>
                    <button class="btn btn-secondary" onclick="centerServos()">
                        Center Servos
                    </button>
                    <div class="alert-info" style="padding: 10px; border-radius: 5px; flex-grow: 1;">
                        Toggle monitoring to enable/disable motion tracking and webhook notifications
                    </div>
                </div>
            </div>

            <!-- Servo Slider Control -->
            <div class="control-section">
                <h3>üéØ Precision Servo Control</h3>
                <div class="servo-controls">
                    <!-- Pan Control -->
                    <div class="servo-axis">
                        <h4>Pan (Left/Right)</h4>
                        <input type="range" id="pan-slider" min="0" max="180" value="90"
                               oninput="updateServoDisplay('pan', this.value)"
                               onchange="moveServo()">
                        <div class="angle-display" id="pan-display">90¬∞</div>
                        <div class="direction-buttons">
                            <button class="dir-btn" onclick="adjustServo('pan', -15)">‚óÄ‚óÄ</button>
                            <button class="dir-btn" onclick="adjustServo('pan', -5)">‚óÄ</button>
                            <button class="dir-btn" onclick="adjustServo('pan', 5)">‚ñ∂</button>
                            <button class="dir-btn" onclick="adjustServo('pan', 15)">‚ñ∂‚ñ∂</button>
                        </div>
                    </div>

                    <!-- Tilt Control -->
                    <div class="servo-axis">
                        <h4>Tilt (Up/Down)</h4>
                        <input type="range" id="tilt-slider" min="0" max="180" value="90"
                               oninput="updateServoDisplay('tilt', this.value)"
                               onchange="moveServo()">
                        <div class="angle-display" id="tilt-display">90¬∞</div>
                        <div class="direction-buttons">
                            <button class="dir-btn" onclick="adjustServo('tilt', -15)">‚ñº‚ñº</button>
                            <button class="dir-btn" onclick="adjustServo('tilt', -5)">‚ñº</button>
                            <button class="dir-btn" onclick="adjustServo('tilt', 5)">‚ñ≤</button>
                            <button class="dir-btn" onclick="adjustServo('tilt', 15)">‚ñ≤‚ñ≤</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration Section -->
            <div class="control-section config-section">
                <h3>‚öôÔ∏è Configuration</h3>

                <div class="config-group">
                    <h4 style="color: #4fc3f7; margin-bottom: 10px;">üì∑ Camera Settings</h4>
                    <div class="config-row">
                        <span class="config-label">Flip Horizontal</span>
                        <label class="switch">
                            <input type="checkbox" id="flip-horizontal">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Flip Vertical</span>
                        <label class="switch">
                            <input type="checkbox" id="flip-vertical">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="config-row">
                        <span class="config-label">Show Motion Overlay</span>
                        <label class="switch">
                            <input type="checkbox" id="show-motion-overlay">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="config-group">
                    <h4 style="color: #4fc3f7; margin-bottom: 10px;">üéØ Motion Detection</h4>
                    <div class="config-row">
                        <span class="config-label">Motion Sensitivity</span>
                        <input type="number" id="motion-sensitivity" min="0.005" max="0.05" step="0.001" value="0.015">
                    </div>
                </div>

                <div class="config-group">
                    <h4 style="color: #4fc3f7; margin-bottom: 10px;">üéÆ Control Settings</h4>
                    <div class="config-row">
                        <span class="config-label">Button Step Size (¬∞)</span>
                        <input type="number" id="button-step" min="1" max="45" step="1" value="10">
                    </div>
                </div>

                <div class="config-group">
                    <h4 style="color: #4fc3f7; margin-bottom: 10px;">üîî Webhook Settings</h4>
                    <div class="config-row">
                        <span class="config-label">Webhook URL</span>
                    </div>
                    <div class="config-row">
                        <input type="url" id="webhook-url" placeholder="https://example.com/webhook">
                    </div>
                    <div class="config-row">
                        <span class="config-label">Angle Threshold (¬∞)</span>
                        <input type="number" id="webhook-threshold" min="0.5" max="20" step="0.5" value="5">
                    </div>
                    <div class="config-row">
                        <span class="config-label">Cooldown (seconds)</span>
                        <input type="number" id="webhook-cooldown" min="0.5" max="10" step="0.5" value="2">
                    </div>
                </div>

                <button class="btn btn-primary save-btn" onclick="saveConfiguration()">üíæ Save Configuration</button>
            </div>
        </div>

        <footer>
            <p>
                <a href="/snapshot" target="_blank">üì∏ Snapshot</a> |
                <a href="/status" target="_blank">üìä Status API</a> |
                <a href="/healthz" target="_blank">üè• Health Check</a> |
                <a href="/config" target="_blank">‚öôÔ∏è Config API</a>
            </p>
            <p style="margin-top: 10px; font-size: 0.85em; color: #555;">
                Security Camera System ‚Ä¢ DDD Architecture ‚Ä¢ Clean Code
            </p>
        </footer>
    </div>

    <script>
        let monitoringActive = {{ 'true' if monitoring_active else 'false' }};
        let buttonStepSize = 10;  // Default step size

        // Update monitoring UI
        function updateMonitoringUI() {
            const badge = document.getElementById('monitoring-badge');
            const btn = document.getElementById('btn-monitoring-toggle');
            const btnSide = document.getElementById('btn-monitoring-toggle-side');

            if (monitoringActive) {
                badge.className = 'monitoring-badge active';
                badge.textContent = 'üî¥ MONITORING ACTIVE';

                if (btn) {
                    btn.textContent = 'Stop Monitoring';
                    btn.className = 'btn btn-danger';
                }
                if (btnSide) {
                    btnSide.textContent = 'Stop Monitoring';
                    btnSide.className = 'btn btn-danger';
                }
            } else {
                badge.className = 'monitoring-badge inactive';
                badge.textContent = 'MONITORING OFF';

                if (btn) {
                    btn.textContent = 'Start Monitoring';
                    btn.className = 'btn btn-primary';
                }
                if (btnSide) {
                    btnSide.textContent = 'Start Monitoring';
                    btnSide.className = 'btn btn-primary';
                }
            }
        }

        // Toggle monitoring
        async function toggleMonitoring() {
            try {
                const response = await fetch('/monitoring/toggle', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await response.json();
                monitoringActive = data.monitoring_active;
                updateMonitoringUI();
            } catch (error) {
                console.error('Toggle monitoring failed:', error);
            }
        }

        // Update servo display
        function updateServoDisplay(axis, value) {
            document.getElementById(`${axis}-display`).textContent = `${value}¬∞`;
        }

        // Move servo
        async function moveServo() {
            const pan = document.getElementById('pan-slider').value;
            const tilt = document.getElementById('tilt-slider').value;

            try {
                await fetch('/servo/move', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ pan: parseFloat(pan), tilt: parseFloat(tilt) })
                });
            } catch (error) {
                console.error('Move servo failed:', error);
            }
        }

        // D-Pad movement
        async function moveDpad(direction) {
            const panSlider = document.getElementById('pan-slider');
            const tiltSlider = document.getElementById('tilt-slider');
            let pan = parseInt(panSlider.value);
            let tilt = parseInt(tiltSlider.value);

            if (direction === 'up') {
                tilt = Math.max(0, tilt - buttonStepSize);
            } else if (direction === 'down') {
                tilt = Math.min(180, tilt + buttonStepSize);
            } else if (direction === 'left') {
                pan = Math.max(0, pan - buttonStepSize);
            } else if (direction === 'right') {
                pan = Math.min(180, pan + buttonStepSize);
            } else if (direction === 'center') {
                pan = 90;
                tilt = 90;
            }

            panSlider.value = pan;
            tiltSlider.value = tilt;
            updateServoDisplay('pan', pan);
            updateServoDisplay('tilt', tilt);
            moveServo();
        }

        // Adjust servo by delta
        function adjustServo(axis, delta) {
            const slider = document.getElementById(`${axis}-slider`);
            let newValue = parseInt(slider.value) + delta;
            newValue = Math.max(0, Math.min(180, newValue));
            slider.value = newValue;
            updateServoDisplay(axis, newValue);
            moveServo();
        }

        // Center servos
        async function centerServos() {
            document.getElementById('pan-slider').value = 90;
            document.getElementById('tilt-slider').value = 90;
            updateServoDisplay('pan', 90);
            updateServoDisplay('tilt', 90);

            try {
                await fetch('/servo/center', { method: 'POST' });
            } catch (error) {
                console.error('Center servos failed:', error);
            }
        }

        // Load configuration
        async function loadConfiguration() {
            try {
                const response = await fetch('/config');
                const config = await response.json();

                document.getElementById('flip-horizontal').checked = config.flip_horizontal || false;
                document.getElementById('flip-vertical').checked = config.flip_vertical || false;
                document.getElementById('show-motion-overlay').checked = config.show_motion_overlay !== false;
                document.getElementById('motion-sensitivity').value = config.motion_sensitivity || 0.015;
                document.getElementById('button-step').value = config.button_step_size || 10;
                document.getElementById('webhook-url').value = config.webhook_url || '';
                document.getElementById('webhook-threshold').value = config.webhook_angle_threshold || 5;
                document.getElementById('webhook-cooldown').value = config.webhook_cooldown || 2;

                // Update button step size
                buttonStepSize = config.button_step_size || 10;
                document.getElementById('step-display').textContent = buttonStepSize;
            } catch (error) {
                console.error('Load configuration failed:', error);
            }
        }

        // Save configuration
        async function saveConfiguration() {
            const config = {
                flip_horizontal: document.getElementById('flip-horizontal').checked,
                flip_vertical: document.getElementById('flip-vertical').checked,
                show_motion_overlay: document.getElementById('show-motion-overlay').checked,
                motion_sensitivity: parseFloat(document.getElementById('motion-sensitivity').value),
                button_step_size: parseInt(document.getElementById('button-step').value),
                webhook_url: document.getElementById('webhook-url').value.trim(),
                webhook_angle_threshold: parseFloat(document.getElementById('webhook-threshold').value),
                webhook_cooldown: parseFloat(document.getElementById('webhook-cooldown').value)
            };

            try {
                const response = await fetch('/config', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(config)
                });

                const result = await response.json();
                if (result.status === 'ok') {
                    // Show success message with animation
                    const btn = document.querySelector('.save-btn');
                    const originalText = btn.textContent;
                    btn.textContent = '‚úì Configuration Saved!';
                    btn.style.background = 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)';

                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 2000);

                    // Update button step size
                    buttonStepSize = config.button_step_size;
                    document.getElementById('step-display').textContent = buttonStepSize;
                } else {
                    alert('‚ùå Failed to save configuration: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Save configuration failed:', error);
                alert('‚ùå Failed to save configuration');
            }
        }

        // Update status
        async function updateStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();

                document.getElementById('status-camera').textContent = data.camera_active ? '‚úì Active' : '‚ùå Offline';
                document.getElementById('status-servo').textContent = data.servo_connected ? '‚úì Connected' : '‚ùå Disconnected';
                document.getElementById('status-pan').textContent = `${data.current_pan}¬∞`;
                document.getElementById('status-tilt').textContent = `${data.current_tilt}¬∞`;
                document.getElementById('status-webhook').textContent = data.webhook_queue_size;
                document.getElementById('status-motion').textContent = data.total_motion_events || 0;

                monitoringActive = data.monitoring_active;
                updateMonitoringUI();
            } catch (error) {
                console.error('Status update failed:', error);
            }
        }

        // Initialize
        updateMonitoringUI();
        loadConfiguration();
        updateStatus();

        // Poll status every 2 seconds
        setInterval(updateStatus, 2000);
    </script>
</body>
</html>
